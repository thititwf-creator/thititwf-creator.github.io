<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <title>CDD Women Fund Province 2569</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css" />

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            background: linear-gradient(to bottom right, #fce4ec, #f3e5f5);
            color: #000;
        }

        .dashboard-container {
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.95);
            width: 100%;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .header-text h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .header-text h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .cards {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
        }

        .card .value {
            font-size: 1.75rem;
            color: black;
            margin-top: 10px;
            font-weight: normal;
            white-space: nowrap;
        }

        .pink {
            background-color: #e91e63;
        }

        .light-pink {
            background-color: #f8bbd0;
        }

        .orange {
            background-color: #ff9800;
        }

        .deep-pink {
            background-color: #f06292;
        }

        table.dataTable {
            width: 100% !important;
            border-collapse: collapse;
            font-size: 0.85rem;
            color: black;
        }

        table.dataTable th,
        table.dataTable td {
            border: 1px solid #ccc;
            padding: 4px 6px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        table.dataTable thead th {
            background-color: #f06292;
            color: black;
            font-weight: bold;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            gap: 15px;
            padding: 15px;
            background-color: #f8bbd0;
            border-radius: 8px;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 160px;
            flex-grow: 1;
        }

        .filter-item label {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #333;
        }

        .filter-item select {
            width: 100%;
            padding: 6px;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.85rem;
            height: 35px;
        }

        .action-button-container {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 6px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        #btnResetFilter {
            background-color: #d9534f;
        }

        #btnDownload {
            background-color: #5cb85c;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-text">
                <h1><span style="color:navy;">CDD</span> <span style="color:deeppink;">Women</span> <span
                        style="color:red;">Fund</span></h1>
                <h2><span style="color:black;">‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</span> <span style="color:red;" id="province-title"></span>
                </h2>
            </div>

            <div class="logo-container">
                <img src="https://i.postimg.cc/507bjy9Z/cdd.png" width="60" height="100" />
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s"
                    width="70" height="100" />
            </div>
        </div>

        <div style="text-align:right;font-weight:bold;color:navy;margin-top:1rem;font-size:1.2rem;">
            <span id="update-date">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -</span>
        </div>

        <!-- Summary Cards -->
        <div class="cards">

            <div class="card pink">
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                <div class="value" id="num-projects">-</div>
            </div>

            <div class="card light-pink">
                ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                <div class="value" id="approved-money">-</div>
            </div>

            <div class="card orange">
                ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2568
                <div class="value" id="debt-start">-</div>
                ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                <div class="value" id="debt-now">-</div>
            </div>

            <div class="card deep-pink">
                ‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                <div class="value" id="overdue">-</div>
                ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞
                <div class="value" id="percent-overdue">-</div>
            </div>

            <div class="card deep-pink">
                ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢
                <div class="value" id="legal">-</div>
            </div>

            <!-- ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ -->
            <div class="card light-pink">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)
                <div class="value" id="normal-count">-</div>
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞)
                <div class="value" id="normal-amount">-</div>
            </div>

            <!-- ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏Ñ) -->
            <div class="card light-pink">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏Ñ) ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                <div class="value" id="restructure-count">-</div>
                ‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î ‚Äú‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢ (‡∏Ñ)‚Äù
                <div class="value" id="restructure-sum">-</div>
            </div>

            <!-- ‡∏´‡∏ô‡∏µ‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡πÅ‡∏û‡πà‡∏á (‡∏á1‚Äì‡∏á2) -->
            <div class="card orange">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡πÅ‡∏û‡πà‡∏á ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏á1 + ‡∏á2)
                <div class="value" id="civil-count">-</div>

                ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏á1)
                <div class="value" id="civil-prosecutor">-</div>

                ‡∏®‡∏≤‡∏•‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏ü‡πâ‡∏≠‡∏á (‡∏á2)
                <div class="value" id="civil-court">-</div>

                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏á1 + ‡∏á2)
                <div class="value" id="civil-sum">-</div>
            </div>
            <!-- ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß (‡∏á3‚Äì‡∏á5) -->
            <div class="card deep-pink">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏á3 + ‡∏á4 + ‡∏á5)
                <div class="value" id="judged-count">-</div>

                ‡∏®‡∏≤‡∏•‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (‡∏á3)
                <div class="value" id="judged-3">-</div>

                ‡∏®‡∏≤‡∏•‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏° (‡∏á4)
                <div class="value" id="judged-4">-</div>

                ‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ (‡∏á5)
                <div class="value" id="judged-5">-</div>

                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏á3 + ‡∏á4 + ‡∏á5)
                <div class="value" id="judged-sum">-</div>
            </div>

            <!-- ‡∏´‡∏ô‡∏µ‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤ (‡∏á6) -->
            <div class="card orange">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤ ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                <div class="value" id="criminal-count">-</div>

                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏á6)
                <div class="value" id="criminal-sum">-</div>
            </div>
        </div>




        <h3>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
        <div id="filter-section" class="filter-container"></div>

        <div class="filter-container">
            <div class="filter-item">
                <label for="downloadType">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</label>
                <select id="downloadType">
                    <option value="excel">Excel</option>
                </select>
            </div>
            <div class="action-button-container">
                <button id="btnDownload">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
                <button id="btnResetFilter">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
            </div>
        </div>

        <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</h3>
        <table id="detailsTable" class="display" style="width:100%">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwwxjRdiPSd7SOuZAOO5OmWi5NHCBMOf3d1923ik9QBY7iiZ0gJl6ppcQQUHGrxuLRTAg/exec";  // ‚≠ê ‡πÉ‡∏™‡πà URL Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚≠ê

        let originalData = [];
        let summary = {};

        async function loadData() {
            try {
                const res = await fetch("URL_API");
                const json = await res.json();

                // ‡πÄ‡∏Å‡πá‡∏ö summary ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                summary = json.summary;

                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏ñ‡∏ß‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)
                originalData = (json.data || []).filter(r => r["‡∏•‡∏≥‡∏î‡∏±‡∏ö"] !== "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î");

                // ‡πÇ‡∏´‡∏•‡∏î dropdown ‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                loadDistrictOptions(originalData);
                loadSubDistrictOptions(originalData);

                // üî•üî• ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î API üî•üî•
                renderTable(originalData);
                updateSummaryFromFiltered(originalData);  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì summary ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
                updateSummaryCards(summary);              // ‡∏´‡∏£‡∏∑‡∏≠ summary ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î

            } catch (err) {
                console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", err);
            }
        }
        let allData = [], filteredData = [], dataTable, originalSummary = null;

        const formatNumber = v => isNaN(parseFloat(v)) ? "-" : parseFloat(v).toLocaleString("th-TH", { minimumFractionDigits: 2 });
        const formatPercent = v => isNaN(parseFloat(v)) ? "-" : `${parseFloat(v).toFixed(2)}%`;

        $(document).ready(async function () {
            const province = new URLSearchParams(window.location.search).get("province");
            $("#province-title").text(province || "-");

            $("#btnResetFilter").on("click", () => {
                $("#filter-section select").val("").trigger("change");
                filteredData = allData;
                renderTable(allData);
                updateSummaryFromFiltered(allData); // summary ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°
                // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô summary ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á
                // updateSummaryCards(originalSummary);
            });

            $("#btnDownload").on("click", downloadData);

            await fetchData(province);  // ‡πÇ‡∏´‡∏•‡∏î + render + summary + filter
        });

        async function fetchData(province) {
            try {
                const res = await fetch(`${API_URL}?province=${encodeURIComponent(province)}`);
                const json = await res.json();

                if (json.error) throw new Error(json.error);

                allData = json.data || [];
                originalSummary = json.summary;

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                updateSummaryCards(json.summary);

                // ‚≠ê ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                renderTable(allData);

                // ‚≠ê ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì summary ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
                updateSummaryFromFiltered(allData);

                // ‚≠ê ‡πÇ‡∏´‡∏•‡∏î filter
                setupFilters(allData);

            } catch (err) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
            }
        }

        function renderTable(data) {
            const table = $("#detailsTable");

            // ‚ùó ‡∏ï‡πâ‡∏≠‡∏á destroy ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô DataTable ‡∏à‡∏∞‡∏à‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
            if ($.fn.DataTable.isDataTable("#detailsTable")) {
                table.DataTable().clear().destroy();
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á header ‡πÉ‡∏´‡∏°‡πà
            const headers = Object.keys(data[0] || {});
            $("#detailsTable thead").html(`<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á body ‡πÉ‡∏´‡∏°‡πà
            const tbody = $("#detailsTable tbody").empty();
            data.forEach(row => {
                tbody.append(`<tr>${headers.map(h => `<td>${row[h] ?? "-"}</td>`).join("")}</tr>`);
            });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á DataTable ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏î
            table.DataTable({
                scrollX: true,
                pageLength: 10
            });
        }


        function setupFilters(data) {

            const keys = ["‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï", "‡∏ï‡∏≥‡∏ö‡∏•", "‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"];
            const container = $("#filter-section").empty();

            // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ---
            keys.forEach(k => {
                container.append(`
            <div class="filter-item">
                <label>${k}</label>
                <select data-key="${k}">
                    <option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                </select>
            </div>
        `);
            });

            const selects = $("#filter-section select");

            // ----------------------------------------------------
            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤ dropdown ‡πÇ‡∏î‡∏¢ "‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
            // ----------------------------------------------------
            function refreshDropdowns(filtered) {
                selects.each(function () {
                    const key = $(this).data("key");
                    const current = String($(this).val() || "");

                    let options = [...new Set(filtered
                        .map(r => r[key])
                        .filter(v => v !== undefined && v !== null)
                    )].map(v => String(v));   // ‚≠ê ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô String

                    // Render dropdown
                    $(this).html(
                        `<option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>` +
                        options.map(v => `<option value="${v}">${v}</option>`).join("")
                    );

                    // ‚≠ê ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏° (‡πÅ‡∏ö‡∏ö string)
                    if (current && options.includes(current)) {
                        $(this).val(current);
                    }
                });
            }


            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            refreshDropdowns(data);

            // ----------------------------------------------------
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            // ----------------------------------------------------
            function filterData() {

                let filtered = [...data];

                selects.each(function () {
                    const key = $(this).data("key");
                    const val = $(this).val();

                    if (val) {
                        filtered = filtered.filter(r => r[key] == val);
                    }
                });

                // ‚≠ê ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
                filteredData = filtered;

                // ‚≠ê ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á
                renderTable(filteredData);

                // ‚≠ê ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï summary ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≠‡∏á
                updateSummaryFromFiltered(filteredData);

                // ‚≠ê ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï dropdown
                refreshDropdowns(filtered);
            }


            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤ filter
            selects.on("change", filterData);
        }



        function updateSummaryCards(s) {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô s ‡πÄ‡∏õ‡πá‡∏ô undefined
            s = s || {};

            // ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô number (fallback ‡πÄ‡∏õ‡πá‡∏ô 0)
            const safeNum = v => {
                if (v === null || v === undefined || v === "") return 0;
                const n = Number(v);
                return Number.isFinite(n) ? n : 0;
            };

            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô formatNumber/formatPercent ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
            const fmtNum = typeof formatNumber === "function"
                ? (v) => formatNumber(v)
                : (v) => (safeNum(v)).toLocaleString("th-TH", { minimumFractionDigits: 2 });

            const fmtPct = typeof formatPercent === "function"
                ? (v) => formatPercent(v)
                : (v) => `${safeNum(v).toFixed(2)}%`;

            // ======= ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏≤ =======
            const totalProjects = safeNum(s.totalProjects ?? s.numProjects ?? s.total_projects ?? s.numProject ?? s.num_projects);
            const approvedMoney = safeNum(s.approvedMoney ?? s.approved_money ?? s.approved ?? s.approvedMoney);
            const debtStart = safeNum(s.debtStart ?? s.debt_start ?? s.debtStart);
            const debtNow = safeNum(s.debtNow ?? s.debt_now ?? s.debtNow);
            const overdue = safeNum(s.overdue ?? s.overdueAmount ?? s.overdue_amount);
            const percentOverdue = s.percentOverdue ?? s.percent_overdue ?? s.percentOverdue ?? 0;
            const legal = safeNum(s.legal ?? s.legalAmount ?? s.legal_amount);

            // ======= ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å data (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå) =======
            const normalCount = safeNum(s.normalCount ?? s.normal?.count ?? s.normal_count ?? s.normal?.cnt);
            const normalAmount = safeNum(s.normalAmount ?? s.normal?.amount ?? s.normal?.sum ?? s.normal_amount);

            const restructureCount = safeNum(s.restructureCount ?? s.restructure?.count ?? s.restructure_count);
            const restructureSum = safeNum(s.restructureSum ?? s.restructure?.sum ?? s.restructure_sum ?? s.restructTotal ?? s.restruct_sum);

            const civilCount = safeNum(s.civilCount ?? s.civil?.count ?? s.civil_count ?? s.civilCount);
            const civilSum = safeNum(s.civilSum ?? s.civil?.sum ?? s.civil_sum ?? s.civilTotal ?? s.civilTotal);

            // ‡πÅ‡∏¢‡∏Å‡∏á1 / ‡∏á2 (‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö)
            const civilNg1Count = safeNum(
                s.civilNg1Count ?? s.civilNg1Count ?? s.civil_ng1_count ?? s.sumNg1Count ?? s.civil?.ng1Count
            );
            const civilNg1Sum = safeNum(
                s.civilNg1Sum ?? s.sumNg1 ?? s.civil_ng1_sum ?? s.civil?.ng1Sum ?? s.sumNg1
            );

            const civilNg2Count = safeNum(
                s.civilNg2Count ?? s.civil_ng2_count ?? s.sumNg2Count ?? s.civil?.ng2Count
            );
            const civilNg2Sum = safeNum(
                s.civilNg2Sum ?? s.sumNg2 ?? s.civil_ng2_sum ?? s.civil?.ng2Sum ?? s.sumNg2
            );

            // ‡∏á3-‡∏á5 (‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤)
            const judgedCount = safeNum(s.judgedCount ?? s.judgement?.count ?? s.judgementCount ?? s.judgement_count);
            const judgedSum = safeNum(s.judgedSum ?? s.judgement?.sum ?? s.judgementSum ?? s.judgement_sum);

            const judged3Count = safeNum(s.judged3Count ?? s.judgement3Count ?? s.judgement?.g3Count);
            const judged3Sum = safeNum(s.judged3Sum ?? s.judgement3Sum ?? s.judgement?.g3Sum);

            const judged4Count = safeNum(s.judged4Count ?? s.judgement4Count ?? s.judgement?.g4Count);
            const judged4Sum = safeNum(s.judged4Sum ?? s.judgement4Sum ?? s.judgement?.g4Sum);

            const judged5Count = safeNum(s.judged5Count ?? s.judgement5Count ?? s.judgement?.g5Count);
            const judged5Sum = safeNum(s.judged5Sum ?? s.judgement5Sum ?? s.judgement?.g5Sum);

            // ‡∏á6 (‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤)
            const criminalCount = safeNum(s.criminalCount ?? s.criminal?.count ?? s.criminal_count);
            const criminalSum = safeNum(s.criminalSum ?? s.criminal?.sum ?? s.criminal_sum);

            // ======= ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï DOM ‚Äî ‡πÄ‡∏ä‡πá‡∏Ñ element ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error =======
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.textContent = text;
            };

            // ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏à‡∏≤‡∏Å summary API)
            setText("num-projects", totalProjects.toLocaleString("th-TH"));
            setText("approved-money", fmtNum(approvedMoney));
            setText("debt-start", fmtNum(debtStart));
            setText("debt-now", fmtNum(debtNow));
            setText("overdue", fmtNum(overdue));
            setText("percent-overdue", fmtPct(percentOverdue));
            setText("legal", fmtNum(legal));

            // ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å data (‡∏à‡∏≤‡∏Å updateSummaryFromFiltered)
            setText("normal-count", normalCount.toLocaleString("th-TH"));
            setText("normal-amount", fmtNum(normalAmount));

            setText("restructure-count", restructureCount.toLocaleString("th-TH"));
            setText("restructure-sum", fmtNum(restructureSum));

            setText("civil-count", civilCount.toLocaleString("th-TH"));

            // ‡πÅ‡∏¢‡∏Å‡∏á1 / ‡∏á2 ‚Äî ‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏≠‡∏á civil-prosecutor / civil-court ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á "X ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / Y ‡∏ö‡∏≤‡∏ó"
            const elCivilProc = document.getElementById("civil-prosecutor");
            if (elCivilProc) {
                elCivilProc.textContent = `${civilNg1Count.toLocaleString()} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / ${fmtNum(civilNg1Sum)}`;
            }
            const elCivilCourt = document.getElementById("civil-court");
            if (elCivilCourt) {
                elCivilCourt.textContent = `${civilNg2Count.toLocaleString()} ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / ${fmtNum(civilNg2Sum)}`;
            }

            setText("civil-sum", fmtNum(civilSum));

            // ‡∏á3-‡∏á5 (‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤)
            setText("judged-count", judgedCount.toLocaleString("th-TH"));
            setText("judged-sum", fmtNum(judgedSum));
            setText("judged-3", `${judged3Count.toLocaleString()} / ${fmtNum(judged3Sum)}`);
            setText("judged-4", `${judged4Count.toLocaleString()} / ${fmtNum(judged4Sum)}`);
            setText("judged-5", `${judged5Count.toLocaleString()} / ${fmtNum(judged5Sum)}`);

            // ‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤ ‡∏á6
            setText("criminal-count", criminalCount.toLocaleString("th-TH"));
            setText("criminal-sum", fmtNum(criminalSum));
        }


        function calculateNormalDebt(data) {
            let filtered = data.filter(r =>
                parseFloat(r["‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)"]) > 0 &&
                parseFloat(r["‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)"]) > 0 &&
                parseFloat(r["‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)"]) == 0 &&
                parseFloat(r["‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)"]) == 0 &&
                parseFloat(r["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)"]) == 0
            );

            let count = filtered.length;
            let amount = filtered.reduce(
                (sum, r) => sum + (parseFloat(r["‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)"]) || 0),
                0
            );

            return { count, amount };
        }

        function updateSummaryFromFiltered(data) {

            // ‚ùó ‡∏ï‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"
            data = data.filter(row => row["‡∏•‡∏≥‡∏î‡∏±‡∏ö"] !== "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î");

            // ========== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏î‡∏¥‡∏° ==========
            let normalCount = 0, normalAmount = 0;
            let restructureCount = 0, restructureSum = 0;
            let civilCount = 0, civilSum = 0, civilCount1 = 0, civilSum1 = 0, civilCount2 = 0, civilSum2 = 0;

            // ========== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà ==========
            let judgedCount = 0;      // ‡∏£‡∏ß‡∏°‡∏á3,4,5
            let judged3Count = 0, judged3Sum = 0;
            let judged4Count = 0, judged4Sum = 0;
            let judged5Count = 0, judged5Sum = 0;
            let judgedSum = 0;

            let criminalCount = 0;
            let criminalSum = 0;

            data.forEach(row => {

                const g = parseFloat(row["‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)"]) || 0;
                const kh = parseFloat(row["‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)"]) || 0;
                const k = parseFloat(row["‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)"]) || 0;
                const ng = parseFloat(row["‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)"]) || 0;
                const b = parseFloat(row["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)"]) || 0;

                const ng1 = parseFloat(row["‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á(‡∏á1)"]) || 0;
                const ng2 = parseFloat(row["‡∏®‡∏≤‡∏•‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏ü‡πâ‡∏≠‡∏á(‡∏á2)"]) || 0;

                const ng3 = parseFloat(row["‡∏®‡∏≤‡∏•‡πÑ‡∏î‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ(‡∏á3)"]) || 0;
                const ng4 = parseFloat(row["‡∏®‡∏≤‡∏•‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏°(‡∏á4)"]) || 0;
                const ng5 = parseFloat(row["‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ(‡∏á5)"]) || 0;

                const ng6 = parseFloat(row["‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤(‡∏á6)"]) || 0;

                // ===============================
                // 1) ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏Å‡∏ï‡∏¥
                // ===============================
                if (g > 0 && kh > 0 && k === 0 && ng === 0) {
                    normalCount++;
                    normalAmount += kh;
                }

                // ===============================
                // 2) ‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏Ñ)
                // ===============================
                if (g > 0 && k > 0) {
                    restructureCount++;
                    restructureSum += k;
                }

                // ===============================
                // 3) ‡∏´‡∏ô‡∏µ‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡πÅ‡∏û‡πà‡∏á (‡∏á1‚Äì‡∏á2)
                // ===============================
                if (g > 0 && (ng1 > 0 || ng2 > 0)) {
                    civilCount++;
                    civilSum += (ng1 + ng2);

                    if (ng1 > 0) { civilCount1++; civilSum1 += ng1; }
                    if (ng2 > 0) { civilCount2++; civilSum2 += ng2; }
                }

                // ===============================
                // 4) ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß (‡∏á3‚Äì‡∏á5)
                // ===============================
                if (g > 0 && (ng3 > 0 || ng4 > 0 || ng5 > 0)) {

                    judgedCount++;
                    judgedSum += (ng3 + ng4 + ng5);

                    if (ng3 > 0) { judged3Count++; judged3Sum += ng3; }
                    if (ng4 > 0) { judged4Count++; judged4Sum += ng4; }
                    if (ng5 > 0) { judged5Count++; judged5Sum += ng5; }
                }

                // ===============================
                // 5) ‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤ (‡∏á6)
                // ===============================
                if (g > 0 && ng6 > 0) {
                    criminalCount++;
                    criminalSum += ng6;
                }
            });

            // ========== UPDATE HTML ==========
            document.getElementById("normal-count").textContent = normalCount.toLocaleString();
            document.getElementById("normal-amount").textContent = normalAmount.toLocaleString();

            document.getElementById("restructure-count").textContent = restructureCount.toLocaleString();
            document.getElementById("restructure-sum").textContent = restructureSum.toLocaleString();

            document.getElementById("civil-count").textContent = civilCount.toLocaleString();
            document.getElementById("civil-prosecutor").textContent = `${civilCount1.toLocaleString()} / ${civilSum1.toLocaleString()}`;
            document.getElementById("civil-court").textContent = `${civilCount2.toLocaleString()} / ${civilSum2.toLocaleString()}`;
            document.getElementById("civil-sum").textContent = civilSum.toLocaleString();

            document.getElementById("judged-count").textContent = judgedCount.toLocaleString();
            document.getElementById("judged-3").textContent = `${judged3Count} / ${judged3Sum.toLocaleString()}`;
            document.getElementById("judged-4").textContent = `${judged4Count} / ${judged4Sum.toLocaleString()}`;
            document.getElementById("judged-5").textContent = `${judged5Count} / ${judged5Sum.toLocaleString()}`;
            document.getElementById("judged-sum").textContent = judgedSum.toLocaleString();

            document.getElementById("criminal-count").textContent = criminalCount.toLocaleString();
            document.getElementById("criminal-sum").textContent = criminalSum.toLocaleString();
        }

        function downloadData() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(allData);
            XLSX.utils.book_append_sheet(wb, ws, "Province");
            XLSX.writeFile(wb, `${$("#province-title").text()}_KPI69.xlsx`);
        }
    </script>

</body>

</html>