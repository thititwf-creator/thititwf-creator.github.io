<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <title>CDD Women Fund Province 2569</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css" />

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            background: linear-gradient(to bottom right, #fce4ec, #f3e5f5);
            color: #000;
        }

        .dashboard-container {
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.95);
            width: 100%;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .header-text h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .header-text h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .cards {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
        }

        .card .value {
            font-size: 1.75rem;
            color: black;
            margin-top: 10px;
            font-weight: normal;
            white-space: nowrap;
        }

        .pink {
            background-color: #e91e63;
        }

        .light-pink {
            background-color: #f8bbd0;
        }

        .orange {
            background-color: #ff9800;
        }

        .deep-pink {
            background-color: #f06292;
        }

        table.dataTable {
            width: 100% !important;
            border-collapse: collapse;
            font-size: 0.85rem;
            color: black;
        }

        table.dataTable th,
        table.dataTable td {
            border: 1px solid #ccc;
            padding: 4px 6px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        table.dataTable thead th {
            background-color: #f06292;
            color: black;
            font-weight: bold;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            gap: 15px;
            padding: 15px;
            background-color: #f8bbd0;
            border-radius: 8px;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 160px;
            flex-grow: 1;
        }

        .filter-item label {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #333;
        }

        .filter-item select {
            width: 100%;
            padding: 6px;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.85rem;
            height: 35px;
        }

        .action-button-container {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 6px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        #btnResetFilter {
            background-color: #d9534f;
        }

        #btnDownload {
            background-color: #5cb85c;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-text">
                <h1><span style="color:navy;">CDD</span> <span style="color:deeppink;">Women</span> <span
                        style="color:red;">Fund</span></h1>
                <h2><span style="color:black;">รายจังหวัด:</span> <span style="color:red;" id="province-title"></span>
                </h2>
            </div>

            <div class="logo-container">
                <img src="https://i.postimg.cc/507bjy9Z/cdd.png" width="60" height="100" />
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s"
                    width="70" height="100" />
            </div>
        </div>

        <div style="text-align:right;font-weight:bold;color:navy;margin-top:1rem;font-size:1.2rem;">
            <span id="update-date">ข้อมูล ณ วันที่ -</span>
        </div>

        <!-- Summary Cards -->
        <div class="cards">

            <div class="card pink">
                จำนวนโครงการ
                <div class="value" id="num-projects">-</div>
            </div>

            <div class="card light-pink">
                เงินอนุมัติ
                <div class="value" id="approved-money">-</div>
            </div>

            <div class="card orange">
                ลูกหนี้คงเหลือ ณ 1 ต.ค. 2568
                <div class="value" id="debt-start">-</div>
                ลูกหนี้ปัจจุบัน
                <div class="value" id="debt-now">-</div>
            </div>

            <div class="card deep-pink">
                หนี้เกินกำหนด
                <div class="value" id="overdue">-</div>
                ร้อยละ
                <div class="value" id="percent-overdue">-</div>
            </div>

            <div class="card deep-pink">
                ดำเนินการตามกฎหมาย
                <div class="value" id="legal">-</div>
            </div>

            <!-- หนี้ปกติ -->
            <div class="card light-pink">
                หนี้ปกติ (จำนวนโครงการ)
                <div class="value" id="normal-count">-</div>
                จำนวนเงินรวม (หนี้ยังไม่ถึงกำหนดชำระ)
                <div class="value" id="normal-amount">-</div>
            </div>

            <!-- หนี้ปรับโครงสร้าง (ค) -->
            <div class="card light-pink">
                หนี้ปรับโครงสร้าง (ค) – จำนวนโครงการ
                <div class="value" id="restructure-count">-</div>
                ผลรวมยอด “การไกล่เกลี่ย (ค)”
                <div class="value" id="restructure-sum">-</div>
            </div>

            <!-- หนี้ดำเนินคดีแพ่ง (ง1–ง2) -->
            <div class="card orange">
                หนี้ที่อยู่ระหว่างดำเนินคดีแพ่ง – จำนวนโครงการ (ง1 + ง2)
                <div class="value" id="civil-count">-</div>

                พนักงานอัยการรับเรื่อง (ง1)
                <div class="value" id="civil-prosecutor">-</div>

                ศาลประทับรับฟ้อง (ง2)
                <div class="value" id="civil-court">-</div>

                จำนวนเงินรวม (ง1 + ง2)
                <div class="value" id="civil-sum">-</div>
            </div>
            <!-- หนี้ที่มีคำพิพากษาแล้ว (ง3–ง5) -->
            <div class="card deep-pink">
                หนี้ที่มีคำพิพากษาแล้ว – จำนวนโครงการ (ง3 + ง4 + ง5)
                <div class="value" id="judged-count">-</div>

                ศาลพิพากษาให้ชำระหนี้ (ง3)
                <div class="value" id="judged-3">-</div>

                ศาลพิพากษาตามยอม (ง4)
                <div class="value" id="judged-4">-</div>

                ป.วิ แพ่ง มาตรา 20 ตรี (ง5)
                <div class="value" id="judged-5">-</div>

                จำนวนเงินรวม (ง3 + ง4 + ง5)
                <div class="value" id="judged-sum">-</div>
            </div>

            <!-- หนี้ดำเนินคดีอาญา (ง6) -->
            <div class="card orange">
                หนี้ที่อยู่ระหว่างดำเนินคดีอาญา – จำนวนโครงการ
                <div class="value" id="criminal-count">-</div>

                จำนวนเงินรวม (ง6)
                <div class="value" id="criminal-sum">-</div>
            </div>
        </div>




        <h3>ตัวกรองข้อมูล</h3>
        <div id="filter-section" class="filter-container"></div>

        <div class="filter-container">
            <div class="filter-item">
                <label for="downloadType">ดาวน์โหลดข้อมูล:</label>
                <select id="downloadType">
                    <option value="excel">Excel</option>
                </select>
            </div>
            <div class="action-button-container">
                <button id="btnDownload">ดาวน์โหลด</button>
                <button id="btnResetFilter">ล้างตัวกรอง</button>
            </div>
        </div>

        <h3>ตารางรายละเอียดข้อมูลโครงการรายอำเภอ</h3>
        <table id="detailsTable" class="display" style="width:100%">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwwxjRdiPSd7SOuZAOO5OmWi5NHCBMOf3d1923ik9QBY7iiZ0gJl6ppcQQUHGrxuLRTAg/exec";  // ⭐ ใส่ URL Apps Script ของคุณตรงนี้ ⭐

        let allData = [], dataTable, originalSummary = null;

        const formatNumber = v => isNaN(parseFloat(v)) ? "-" : parseFloat(v).toLocaleString("th-TH", { minimumFractionDigits: 2 });
        const formatPercent = v => isNaN(parseFloat(v)) ? "-" : `${parseFloat(v).toFixed(2)}%`;

        $(document).ready(async function () {
            const province = new URLSearchParams(window.location.search).get("province");
            $("#province-title").text(province || "-");

            $("#btnResetFilter").on("click", () => {
                $("#filter-section select").val("").trigger("change");
                renderTable(allData);
                updateSummaryCards(originalSummary);
            });

            $("#btnDownload").on("click", downloadData);

            await fetchData(province);
        });

        async function fetchData(province) {
            try {
                const res = await fetch(`${API_URL}?province=${encodeURIComponent(province)}`);
                const json = await res.json();

                if (json.error) throw new Error(json.error);

                allData = json.data || [];
                originalSummary = json.summary;

                updateSummaryCards(json.summary);
                renderTable(allData);
                setupFilters(allData);

            } catch (err) {
                alert("เกิดข้อผิดพลาด: " + err.message);
            }
        }

        function renderTable(data) {
            const headers = Object.keys(data[0] || {});
            $("#detailsTable thead").html(`<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`);
            const tbody = $("#detailsTable tbody").empty();

            data.forEach(row => {
                tbody.append(`<tr>${headers.map(h => `<td>${row[h] ?? "-"}</td>`).join("")}</tr>`);
            });

            if ($.fn.DataTable.isDataTable("#detailsTable")) {
                $("#detailsTable").DataTable().destroy();
            }

            dataTable = $("#detailsTable").DataTable({ scrollX: true, pageLength: 10 });
        }

        function setupFilters(data) {
            const keys = ["อำเภอ/เขต", "ตำบล", "ปีงบประมาณ", "สถานะโครงการ"];
            const container = $("#filter-section").empty();

            // สร้าง select สำหรับแต่ละ key
            keys.forEach(k => {
                container.append(`
      <div class="filter-item">
        <label>${k}</label>
        <select data-key="${k}">
          <option value="">-- ทั้งหมด --</option>
        </select>
      </div>
    `);
            });

            const selects = $("#filter-section select");

            // เติมค่าเริ่มต้นให้ select
            function updateSelectOptions(filteredData) {
                selects.each(function () {
                    const key = $(this).data("key");
                    const currentVal = $(this).val();

                    let options = [...new Set(filteredData.map(r => r[key]).filter(Boolean))].sort();
                    const html = `<option value="">-- ทั้งหมด --</option>` + options.map(v => `<option value="${v}">${v}</option>`).join("");
                    $(this).html(html);

                    if (options.includes(currentVal)) $(this).val(currentVal);
                });
            }

            // กรองข้อมูลตาม select ทั้งหมด
            function filterData() {
                let filtered = [...allData];

                selects.each(function () {
                    const key = $(this).data("key");
                    const val = $(this).val();
                    if (val) {
                        filtered = filtered.filter(r => r[key] == val);
                    }
                });

                renderTable(filtered); // แสดงเฉพาะข้อมูลที่กรองแล้ว
                updateSummaryFromFiltered(filtered); // อัปเดตการ์ดสรุป

                // อัปเดตตัวเลือก select ให้ตรงกับข้อมูลที่กรอง (dependent)
                updateSelectOptions(filtered);
            }

            // เติมตัวเลือกครั้งแรก
            updateSelectOptions(data);

            // เมื่อ select เปลี่ยน → กรองข้อมูล
            selects.on("change", filterData);
        }

        function updateSummaryCards(s) {
            // ป้องกัน s เป็น undefined
            s = s || {};

            // ช่วยแปลงค่าให้เป็น number (fallback เป็น 0)
            const safeNum = v => {
                if (v === null || v === undefined || v === "") return 0;
                const n = Number(v);
                return Number.isFinite(n) ? n : 0;
            };

            // ถ้ามีฟังก์ชัน formatNumber/formatPercent อยู่แล้ว ให้ใช้ (จากโค้ดของคุณ)
            const fmtNum = typeof formatNumber === "function"
                ? (v) => formatNumber(v)
                : (v) => (safeNum(v)).toLocaleString("th-TH", { minimumFractionDigits: 2 });

            const fmtPct = typeof formatPercent === "function"
                ? (v) => formatPercent(v)
                : (v) => `${safeNum(v).toFixed(2)}%`;

            // ======= หลากหลายรูปแบบชื่อฟิลด์ที่อาจมา =======
            const totalProjects = safeNum(s.totalProjects ?? s.numProjects ?? s.total_projects ?? s.numProject ?? s.num_projects);
            const approvedMoney = safeNum(s.approvedMoney ?? s.approved_money ?? s.approved ?? s.approvedMoney);
            const debtStart = safeNum(s.debtStart ?? s.debt_start ?? s.debtStart);
            const debtNow = safeNum(s.debtNow ?? s.debt_now ?? s.debtNow);
            const overdue = safeNum(s.overdue ?? s.overdueAmount ?? s.overdue_amount);
            const percentOverdue = s.percentOverdue ?? s.percent_overdue ?? s.percentOverdue ?? 0;
            const legal = safeNum(s.legal ?? s.legalAmount ?? s.legal_amount);

            // ======= การ์ดที่คำนวณจาก data (รองรับหลายรูปแบบของชื่อฟิลด์) =======
            const normalCount = safeNum(s.normalCount ?? s.normal?.count ?? s.normal_count ?? s.normal?.cnt);
            const normalAmount = safeNum(s.normalAmount ?? s.normal?.amount ?? s.normal?.sum ?? s.normal_amount);

            const restructureCount = safeNum(s.restructureCount ?? s.restructure?.count ?? s.restructure_count);
            const restructureSum = safeNum(s.restructureSum ?? s.restructure?.sum ?? s.restructure_sum ?? s.restructTotal ?? s.restruct_sum);

            const civilCount = safeNum(s.civilCount ?? s.civil?.count ?? s.civil_count ?? s.civilCount);
            const civilSum = safeNum(s.civilSum ?? s.civil?.sum ?? s.civil_sum ?? s.civilTotal ?? s.civilTotal);

            // แยกง1 / ง2 (ชื่อฟิลด์หลากหลายรูปแบบ)
            const civilNg1Count = safeNum(
                s.civilNg1Count ?? s.civilNg1Count ?? s.civil_ng1_count ?? s.sumNg1Count ?? s.civil?.ng1Count
            );
            const civilNg1Sum = safeNum(
                s.civilNg1Sum ?? s.sumNg1 ?? s.civil_ng1_sum ?? s.civil?.ng1Sum ?? s.sumNg1
            );

            const civilNg2Count = safeNum(
                s.civilNg2Count ?? s.civil_ng2_count ?? s.sumNg2Count ?? s.civil?.ng2Count
            );
            const civilNg2Sum = safeNum(
                s.civilNg2Sum ?? s.sumNg2 ?? s.civil_ng2_sum ?? s.civil?.ng2Sum ?? s.sumNg2
            );

            // ง3-ง5 (คำพิพากษา)
            const judgedCount = safeNum(s.judgedCount ?? s.judgement?.count ?? s.judgementCount ?? s.judgement_count);
            const judgedSum = safeNum(s.judgedSum ?? s.judgement?.sum ?? s.judgementSum ?? s.judgement_sum);

            const judged3Count = safeNum(s.judged3Count ?? s.judgement3Count ?? s.judgement?.g3Count);
            const judged3Sum = safeNum(s.judged3Sum ?? s.judgement3Sum ?? s.judgement?.g3Sum);

            const judged4Count = safeNum(s.judged4Count ?? s.judgement4Count ?? s.judgement?.g4Count);
            const judged4Sum = safeNum(s.judged4Sum ?? s.judgement4Sum ?? s.judgement?.g4Sum);

            const judged5Count = safeNum(s.judged5Count ?? s.judgement5Count ?? s.judgement?.g5Count);
            const judged5Sum = safeNum(s.judged5Sum ?? s.judgement5Sum ?? s.judgement?.g5Sum);

            // ง6 (คดีอาญา)
            const criminalCount = safeNum(s.criminalCount ?? s.criminal?.count ?? s.criminal_count);
            const criminalSum = safeNum(s.criminalSum ?? s.criminal?.sum ?? s.criminal_sum);

            // ======= อัปเดต DOM — เช็ค element ก่อนอัปเดต เพื่อป้องกัน error =======
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.textContent = text;
            };

            // การ์ดพื้นฐาน (จาก summary API)
            setText("num-projects", totalProjects.toLocaleString("th-TH"));
            setText("approved-money", fmtNum(approvedMoney));
            setText("debt-start", fmtNum(debtStart));
            setText("debt-now", fmtNum(debtNow));
            setText("overdue", fmtNum(overdue));
            setText("percent-overdue", fmtPct(percentOverdue));
            setText("legal", fmtNum(legal));

            // การ์ดที่คำนวณจาก data (จาก updateSummaryFromFiltered)
            setText("normal-count", normalCount.toLocaleString("th-TH"));
            setText("normal-amount", fmtNum(normalAmount));

            setText("restructure-count", restructureCount.toLocaleString("th-TH"));
            setText("restructure-sum", fmtNum(restructureSum));

            setText("civil-count", civilCount.toLocaleString("th-TH"));

            // แยกง1 / ง2 — ถ้าช่อง civil-prosecutor / civil-court มีอยู่ ให้แสดง "X โครงการ / Y บาท"
            const elCivilProc = document.getElementById("civil-prosecutor");
            if (elCivilProc) {
                elCivilProc.textContent = `${civilNg1Count.toLocaleString()} โครงการ / ${fmtNum(civilNg1Sum)}`;
            }
            const elCivilCourt = document.getElementById("civil-court");
            if (elCivilCourt) {
                elCivilCourt.textContent = `${civilNg2Count.toLocaleString()} โครงการ / ${fmtNum(civilNg2Sum)}`;
            }

            setText("civil-sum", fmtNum(civilSum));

            // ง3-ง5 (คำพิพากษา)
            setText("judged-count", judgedCount.toLocaleString("th-TH"));
            setText("judged-sum", fmtNum(judgedSum));
            setText("judged-3", `${judged3Count.toLocaleString()} / ${fmtNum(judged3Sum)}`);
            setText("judged-4", `${judged4Count.toLocaleString()} / ${fmtNum(judged4Sum)}`);
            setText("judged-5", `${judged5Count.toLocaleString()} / ${fmtNum(judged5Sum)}`);

            // คดีอาญา ง6
            setText("criminal-count", criminalCount.toLocaleString("th-TH"));
            setText("criminal-sum", fmtNum(criminalSum));
        }


        function calculateNormalDebt(data) {
            let filtered = data.filter(r =>
                parseFloat(r["ลูกหนี้คงเหลือ ณ ปัจจุบัน (ก)"]) > 0 &&
                parseFloat(r["หนี้ยังไม่ถึงกำหนดชำระ (ข)"]) > 0 &&
                parseFloat(r["การไกล่เกลี่ยที่สามารถใช้บังคับคดีได้ (ค)"]) == 0 &&
                parseFloat(r["ลูกหนี้ที่ได้ดำเนินการตามกฎหมาย (ง)"]) == 0 &&
                parseFloat(r["จำนวนหนี้ที่เกินกำหนดชำระ (B)"]) == 0
            );

            let count = filtered.length;
            let amount = filtered.reduce(
                (sum, r) => sum + (parseFloat(r["หนี้ยังไม่ถึงกำหนดชำระ (ข)"]) || 0),
                0
            );

            return { count, amount };
        }


        function updateSummaryFromFiltered(data) {

            // ❗ ตัดรายการ "ภาพรวมจังหวัด"
            data = data.filter(row => row["ลำดับ"] !== "ภาพรวมจังหวัด");

            // ========== ตัวแปรการ์ดเดิม ==========
            let normalCount = 0, normalAmount = 0;
            let restructureCount = 0, restructureSum = 0;
            let civilCount = 0, civilSum = 0, civilCount1 = 0, civilSum1 = 0, civilCount2 = 0, civilSum2 = 0;

            // ========== ตัวแปรการ์ดใหม่ ==========
            let judgedCount = 0;      // รวมง3,4,5
            let judged3Count = 0, judged3Sum = 0;
            let judged4Count = 0, judged4Sum = 0;
            let judged5Count = 0, judged5Sum = 0;
            let judgedSum = 0;

            let criminalCount = 0;
            let criminalSum = 0;

            data.forEach(row => {

                const g = parseFloat(row["ลูกหนี้คงเหลือ ณ ปัจจุบัน (ก)"]) || 0;
                const kh = parseFloat(row["หนี้ยังไม่ถึงกำหนดชำระ (ข)"]) || 0;
                const k = parseFloat(row["การไกล่เกลี่ยที่สามารถใช้บังคับคดีได้ (ค)"]) || 0;
                const ng = parseFloat(row["ลูกหนี้ที่ได้ดำเนินการตามกฎหมาย (ง)"]) || 0;
                const b = parseFloat(row["จำนวนหนี้ที่เกินกำหนดชำระ (B)"]) || 0;

                const ng1 = parseFloat(row["พนักงานอัยการรับเรื่อง(ง1)"]) || 0;
                const ng2 = parseFloat(row["ศาลประทับรับฟ้อง(ง2)"]) || 0;

                const ng3 = parseFloat(row["ศาลได้มีคำพิพากษาให้ลูกหนี้ชำระหนี้(ง3)"]) || 0;
                const ng4 = parseFloat(row["ศาลมีคำพิพากษาตามยอม(ง4)"]) || 0;
                const ng5 = parseFloat(row["ป.วิ แพ่ง มาตรา 20 ตรี(ง5)"]) || 0;

                const ng6 = parseFloat(row["ดำเนินคดีอาญา(ง6)"]) || 0;

                // ===============================
                // 1) หนี้ปกติ
                // ===============================
                if (g > 0 && kh > 0 && k === 0 && ng === 0 && b === 0) {
                    normalCount++;
                    normalAmount += kh;
                }

                // ===============================
                // 2) หนี้ปรับโครงสร้าง (ค)
                // ===============================
                if (g > 0 && k > 0) {
                    restructureCount++;
                    restructureSum += k;
                }

                // ===============================
                // 3) หนี้ดำเนินคดีแพ่ง (ง1–ง2)
                // ===============================
                if (g > 0 && (ng1 > 0 || ng2 > 0)) {
                    civilCount++;
                    civilSum += (ng1 + ng2);

                    if (ng1 > 0) { civilCount1++; civilSum1 += ng1; }
                    if (ng2 > 0) { civilCount2++; civilSum2 += ng2; }
                }

                // ===============================
                // 4) หนี้ที่มีคำพิพากษาแล้ว (ง3–ง5)
                // ===============================
                if (g > 0 && (ng3 > 0 || ng4 > 0 || ng5 > 0)) {

                    judgedCount++;
                    judgedSum += (ng3 + ng4 + ng5);

                    if (ng3 > 0) { judged3Count++; judged3Sum += ng3; }
                    if (ng4 > 0) { judged4Count++; judged4Sum += ng4; }
                    if (ng5 > 0) { judged5Count++; judged5Sum += ng5; }
                }

                // ===============================
                // 5) หนี้คดีอาญา (ง6)
                // ===============================
                if (g > 0 && ng6 > 0) {
                    criminalCount++;
                    criminalSum += ng6;
                }
            });

            // ========== UPDATE HTML ==========
            document.getElementById("normal-count").textContent = normalCount.toLocaleString();
            document.getElementById("normal-amount").textContent = normalAmount.toLocaleString();

            document.getElementById("restructure-count").textContent = restructureCount.toLocaleString();
            document.getElementById("restructure-sum").textContent = restructureSum.toLocaleString();

            document.getElementById("civil-count").textContent = civilCount.toLocaleString();
            document.getElementById("civil-prosecutor").textContent = `${civilCount1.toLocaleString()} / ${civilSum1.toLocaleString()}`;
            document.getElementById("civil-court").textContent = `${civilCount2.toLocaleString()} / ${civilSum2.toLocaleString()}`;
            document.getElementById("civil-sum").textContent = civilSum.toLocaleString();

            document.getElementById("judged-count").textContent = judgedCount.toLocaleString();
            document.getElementById("judged-3").textContent = `${judged3Count} / ${judged3Sum.toLocaleString()}`;
            document.getElementById("judged-4").textContent = `${judged4Count} / ${judged4Sum.toLocaleString()}`;
            document.getElementById("judged-5").textContent = `${judged5Count} / ${judged5Sum.toLocaleString()}`;
            document.getElementById("judged-sum").textContent = judgedSum.toLocaleString();

            document.getElementById("criminal-count").textContent = criminalCount.toLocaleString();
            document.getElementById("criminal-sum").textContent = criminalSum.toLocaleString();
        }



        function downloadData() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(allData);
            XLSX.utils.book_append_sheet(wb, ws, "Province");
            XLSX.writeFile(wb, `${$("#province-title").text()}_KPI69.xlsx`);
        }
    </script>

</body>

</html>