<!-- ================== TRIS.html ================== -->

<!-- CDN (ใส่ซ้ำได้ ไม่พัง) -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

<style>
  .tris-page {
    font-family: 'Sarabun', sans-serif;
    background: rgba(255,255,255,0.95);
    padding: 30px;
  }

  .tris-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .tris-header h1 {
    margin: 0;
    font-size: 1.8rem;
    color: navy;
  }

  .tris-header h2 {
    margin: 0;
    font-size: 1.2rem;
    color: deeppink;
  }

  table.dataTable.fixedHeader-floating {
    background-color: #fff;
  }

  .summary-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.75rem;
  }

  .summary-table th,
  .summary-table td {
    border: 1px solid #ccc;
    padding: 4px;
    text-align: center;
  }
</style>

<div class="tris-page">

  <div class="tris-header">
    <div>
      <h1>ทะเบียนคุมการรับ-จ่ายเงินฝากคลัง (รหัส 10962)</h1>
      <h2>
        รายงานประจำ <span style="color:red">ตุลาคม</span>
        พ.ศ. <span style="color:red">2567</span>
      </h2>
    </div>
    <div>
      <img src="https://i.postimg.cc/507bjy9Z/cdd.png" height="60">
    </div>
  </div>

  <hr>

  <div style="overflow-x:auto">
    <table id="mainTable" class="summary-table display nowrap">
      <thead>
        <tr>
          <th>ลำดับ</th>
          <th>จังหวัด</th>
          <th>ยกมา</th>
          <th>ทุนหมุนเวียน</th>
          <th>อุดหนุน</th>
          <th>บริหาร</th>
          <th>รวมรายรับ</th>
          <th>รวมรายจ่าย</th>
          <th>คงเหลือ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbxKba4uG2nhNlWzQh7I-OL1uT16UHboBS6wapcppxyWrnR7a1a29aQ2IPoJ1Gqeh8TA/exec";

function formatNumber(n) {
  return Number(n || 0).toLocaleString("th-TH");
}

async function loadTrisData() {
  const res = await fetch(API_URL);
  const data = await res.json();
  const tbody = document.querySelector("#mainTable tbody");
  tbody.innerHTML = "";

  data.rows.forEach((r, i) => {
    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td>${i+1}</td>
        <td>${r.province}</td>
        <td>${formatNumber(r.start)}</td>
        <td>${formatNumber(r.fund)}</td>
        <td>${formatNumber(r.subsidy)}</td>
        <td>${formatNumber(r.admin)}</td>
        <td>${formatNumber(r.totalIncome)}</td>
        <td>${formatNumber(r.provTotalExp)}</td>
        <td>${formatNumber(r.balance)}</td>
      </tr>
    `);
  });

  if ($.fn.DataTable.isDataTable('#mainTable')) {
    $('#mainTable').DataTable().destroy();
  }

  const table = $('#mainTable').DataTable({
    fixedHeader: true,
    scrollX: true,
    pageLength: 10,
    language: {
      search: "ค้นหา:",
      lengthMenu: "แสดง _MENU_ รายการ",
      info: "แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ",
      zeroRecords: "ไม่พบข้อมูล"
    }
  });

  table.on('draw', () => table.fixedHeader.adjust());
}

loadTrisData();
</script>
