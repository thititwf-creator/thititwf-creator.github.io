<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>เลือกจังหวัด</title>
</head>

<body>

    <h3>เลือกจังหวัด</h3>

    <select id="prov"></select>
    <button onclick="go()">ตกลง</button>

    <script>
        // src = "js/config.js"
        const API = "https://script.google.com/macros/s/AKfycbx1pAYMZ3ibMNLpG7Pz7pnnvkT5jc-1OeO-fofHvEq8tnMGu8bwFNBDBnB1HUJ_zKMD/exec";
        const provinces = JSON.parse(localStorage.getItem("provinces"));
        const token = localStorage.getItem("adminToken");

        provinces.forEach(p => {
            prov.innerHTML += `<option value="${p}">${p}</option>`;
        });

        function go() {
            const province = prov.value;

            fetch(`${API}?getTokenOf=${encodeURIComponent(province)}`)
                .then(r => r.json())
                .then(res => {

                    if (!res.token) {
                        alert("ไม่พบ token ของจังหวัดนี้");
                        return;
                    }

                    // ✅ token มีค่าแน่นอน
                    location.href =
                        `province.html?province=${encodeURIComponent(province)}&token=${encodeURIComponent(res.token)}`;
                });
        }
    </script>
</body>

</html>