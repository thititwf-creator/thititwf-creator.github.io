<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px;
        }
        th {
            background: #eee;
        }
    </style>
</head>

<body>

<h3 id="title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</h3>

<table id="tbl">
    <thead></thead>
    <tbody></tbody>
</table>

<script src="js/config.js"></script>

<script>
    const params = new URLSearchParams(location.search);
    const token = params.get("token");

    if (!token) {
        alert("‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        location.href = "login.html";
    }

    // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏î‡πâ‡∏ß‡∏¢ token ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    fetch(`${API}?token=${encodeURIComponent(token)}`)
        .then(r => r.json())
        .then(res => {

            if (res.error) {
                alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á");
                location.href = "login.html";
                return;
            }

            // ‚úÖ backend ‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
            title.innerText = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ${res.province}`;

            const data = res.data || [];
            if (data.length === 0) {
                title.innerText += " (‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)";
                return;
            }

            // ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á =====
            const headers = Object.keys(data[0]);

            tbl.querySelector("thead").innerHTML =
                `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;

            data.forEach(row => {
                const tr = document.createElement("tr");
                headers.forEach(h => {
                    tr.innerHTML += `<td>${row[h] ?? ""}</td>`;
                });
                tbl.querySelector("tbody").appendChild(tr);
            });

            // üîê ‡∏•‡∏ö token ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL
            history.replaceState(
                null,
                "",
                location.pathname
            );
        })
        .catch(err => {
            console.error(err);
            alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        });
</script>

</body>
</html>
