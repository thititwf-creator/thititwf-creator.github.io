<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px;
        }
        th {
            background: #eee;
        }
    </style>
</head>

<body>

<h3 id="title"></h3>

<table id="tbl">
    <thead></thead>
    <tbody></tbody>
</table>
<script src="js/config.js"></script>

<script>
    const params = new URLSearchParams(location.search);
    const province = params.get("province");
    const token = params.get("token");

    if (!province || !token) {
        alert("à¸¥à¸´à¸‡à¸à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡");
        location.href = "login.html";
    }

    title.innerText = `à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” ${province}`;

    fetch(`${API}?province=${encodeURIComponent(province)}&token=${encodeURIComponent(token)}`)
        .then(r => r.json())
        .then(res => {
            if (res.error) {
                alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡");
                location.href = "login.html";
                return;
            }

            // ===== à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸²à¸£à¸²à¸‡ =====
            const headers = Object.keys(res.data[0]);
            tbl.querySelector("thead").innerHTML =
                `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;

            res.data.forEach(row => {
                const tr = document.createElement("tr");
                headers.forEach(h => tr.innerHTML += `<td>${row[h] ?? ""}</td>`);
                tbl.querySelector("tbody").appendChild(tr);
            });

            // ðŸ” à¸¥à¸š token à¸­à¸­à¸à¸ˆà¸²à¸ URL (à¸ªà¸³à¸„à¸±à¸)
            history.replaceState(
                null,
                "",
                `${location.pathname}?province=${encodeURIComponent(province)}`
            );
        })
        .catch(err => {
            console.error(err);
            alert("à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ");
        });
</script>

</body>
</html>
